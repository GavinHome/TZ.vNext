name: TZ.vNext CI

on: 
  push:
    branches:
    - master

jobs:
  build:

    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v1
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 2.2.108
        
    - name: Setup Nuget.exe
      uses: warrenbuckley/Setup-Nuget@v1
      
    - name: Setup Nuget Source
      run: |
        nuget sources add -name "telerik.com" -source "https://nuget.telerik.com/nuget" -UserName "331033463@qq.com" -Password "Tztech@2017"
    
    - name: npm install
      run: |
        cd TZ.vNext.Web
        npm install
        
    - name: replacer:router.d.ts
      run: |
        ".\CIScript\Replacer.exe" ".\TZ.vNext.Web\node_modules\vue-router\types\router.d.ts" 'import Vue = require("vue");' "import Vue from 'vue'"
        type ".\TZ.vNext.Web\node_modules\vue-router\types\router.d.ts"
    - name: replacer:vue.d.ts
      run: |
        ".\CIScript\Replacer.exe" ".\TZ.vNext.Web\node_modules\vue-router\types\vue.d.ts" 'import Vue = require("vue");' "import Vue from 'vue'"
        type ".\TZ.vNext.Web\node_modules\vue-router\types\vue.d.ts"
        
    - name: publish with dotnet
      run: |
        cd TZ.vNext.Web
        dotnet publish --configuration Release
